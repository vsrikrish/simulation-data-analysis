<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.290">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>BEE 4850 - Spring 2024 - Markov Chain Monte Carlo With Turing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../tutorials/julia-plots.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta property="og:title" content="BEE 4850 - Spring 2024 - Markov Chain Monte Carlo With Turing">
<meta property="og:description" content="">
<meta property="og:image" content="https://viveks.me/simulation-data-analysis/tutorials/turing-mcmc_files/figure-html/fig-scatter-regression-output-1.png">
<meta property="og:site-name" content="BEE 4850 - Spring 2024">
<meta property="og:image:height" content="460">
<meta property="og:image:width" content="645">
</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/julia-basics.html">Julia Tutorials</a></li><li class="breadcrumb-item"><a href="../tutorials/turing-mcmc.html">MCMC with Turing</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../_assets/logos/cornell_logo_simple_b31b1b.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">BEE 4850: Environmental Systems Analysis</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/vsrikrish/simulation-data-analysis" title="Github Repository" class="quarto-navigation-tool px-1" aria-label="Github Repository"><i class="bi bi-github"></i></a>
    <a href="https://canvas.cornell.edu" title="Canvas" class="quarto-navigation-tool px-1" aria-label="Canvas"><i class="bi bi-journal-check"></i></a>
    <a href="https://edstem.org" title="Ed Discussion" class="quarto-navigation-tool px-1" aria-label="Ed Discussion"><i class="bi bi-chat-fill"></i></a>
    <a href="https://gradescope.com" title="Gradescope" class="quarto-navigation-tool px-1" aria-label="Gradescope"><i class="bi bi-bar-chart-fill"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Course Information</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class Schedule</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Julia Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/julia-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Julia Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/julia-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making Plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/turing-mcmc.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">MCMC with Turing</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#fitting-a-linear-regression-model" id="toc-fitting-a-linear-regression-model" class="nav-link" data-scroll-target="#fitting-a-linear-regression-model">Fitting A Linear Regression Model</a>
  <ul class="collapse">
  <li><a href="#simulating-data" id="toc-simulating-data" class="nav-link" data-scroll-target="#simulating-data">Simulating Data</a></li>
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model Specification</a></li>
  <li><a href="#using-turing" id="toc-using-turing" class="nav-link" data-scroll-target="#using-turing">Using Turing</a></li>
  <li><a href="#model-diagnostics-and-posterior-predictive-checks" id="toc-model-diagnostics-and-posterior-predictive-checks" class="nav-link" data-scroll-target="#model-diagnostics-and-posterior-predictive-checks">Model Diagnostics and Posterior Predictive Checks</a></li>
  </ul></li>
  <li><a href="#fitting-extreme-value-models-to-tide-gauge-data" id="toc-fitting-extreme-value-models-to-tide-gauge-data" class="nav-link" data-scroll-target="#fitting-extreme-value-models-to-tide-gauge-data">Fitting Extreme Value Models to Tide Gauge Data</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a></li>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model">Fit The Model</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="turing-mcmc.ipynb" download="turing-mcmc.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Markov Chain Monte Carlo With Turing</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This tutorial will give some examples of using <code>Turing.jl</code> and Markov Chain Monte Carlo to sample from posterior distributions.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">default</span>(fmt <span class="op">=</span> <span class="op">:</span>png) <span class="co"># the tide gauge data is long, this keeps images a manageable size</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LaTeXStrings</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Measures</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Optim</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFramesMeta</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dates</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As this tutorial involves random number generation, we will set a random seed to ensure reproducibility.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">1</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fitting-a-linear-regression-model" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="fitting-a-linear-regression-model">Fitting A Linear Regression Model</h2>
<p>Let’s start with a simple example: fitting a linear regression model to simulated data.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Positive Control Tests
</div>
</div>
<div class="callout-body-container callout-body">
<p>Simulating data with a known data-generating process and then trying to obtain the parameters for that process is an important step in any workflow.</p>
</div>
</div>
<section id="simulating-data" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="simulating-data">Simulating Data</h3>
<p>The data-generating process for this example will be: <span class="math display">\[
\begin{gather}
y = 5 + 2x + \varepsilon \\
\varepsilon \sim \text{Normal}(0, 3),
\end{gather}
\]</span> where <span class="math inline">\(\varepsilon\)</span> is so-called “white noise”, which adds stochasticity to the data set. The generated dataset is shown in <a href="#fig-scatter-regression">Figure&nbsp;1</a>.</p>
<div class="cell page-columns page-full" data-execution_count="4">

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="5">
<div id="fig-scatter-regression" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="turing-mcmc_files/figure-html/fig-scatter-regression-output-1.png" class="quarto-discovered-preview-image img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Scatterplot of our generated data.</figcaption><p></p>
</figure>
</div>
</div></div></div>
</section>
<section id="model-specification" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="model-specification">Model Specification</h3>
<p>The statistical model for a standard linear regression problem is <span class="math display">\[
\begin{gather}
y = a + bx + \varepsilon \\
\varepsilon \sim \text{Normal}(0, \sigma).
\end{gather}
\]</span></p>
<p>Rearranging, we can rewrite the likelihood function as: <span class="math display">\[y \sim \text{Normal}(\mu, \sigma),\]</span> where <span class="math inline">\(\mu = a + bx\)</span>. This means that we have three parameters to fit: <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(\sigma^2\)</span>.</p>
<p>Next, we need to select priors on our parameters. We’ll use relatively generic distributions to avoid using the information we have (since we generated the data ourselves), but in practice, we’d want to use any relevant information that we had from our knowledge of the problem. Let’s use relatively diffuse normal distributions for the trend parameters <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> and a half-normal distribution (a normal distribution truncated at 0, to only allow positive values) for the variance <span class="math inline">\(\sigma^2\)</span>, as recommended by <span class="citation" data-cites="Gelman2006-wv">Gelman (<a href="#ref-Gelman2006-wv" role="doc-biblioref">2006</a>)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="ref-Gelman2006-wv" class="csl-entry" role="listitem">
Gelman, A. (2006). Prior distributions for variance parameters in hierarchical models (comment on article by <span>B</span>rowne and <span>D</span>raper). <em>Bayesian Anal.</em>, <em>1</em>(3), 515–533. <a href="https://doi.org/10.1214/06-BA117A">https://doi.org/10.1214/06-BA117A</a>
</div></div><p><span class="math display">\[
\begin{gather}
a \sim \text{Normal(0, 10)} \\
b \sim \text{Normal(0, 10)} \\
\sigma \sim \text{Half-Normal}(0, 25)
\end{gather}
\]</span></p>
</section>
<section id="using-turing" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="using-turing">Using Turing</h3>
<section id="coding-the-model" class="level4">
<h4 class="anchored" data-anchor-id="coding-the-model">Coding the Model</h4>
<p><code>Turing.jl</code> uses the <code>@model</code> macro to specify the model function. We’ll follow the setup in the <a href="https://turinglang.org/dev/tutorials/05-linear-regression">Turing documentation</a>.</p>
<p>To specify distributions on parameters (and the data, which can be thought of as uncertain parameters in Bayesian statistics), use a tilde <code>~</code>, and use equals <code>=</code> for transformations (which we don’t have in this case).</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">linear_regression</span>(x, y)</span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set priors</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">25</span>); lower<span class="op">=</span><span class="fl">0</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">10</span>)</span>
<span id="annotated-cell-3-5"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a>    b <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">10</span>)</span>
<span id="annotated-cell-3-6"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-3-7"><a href="#annotated-cell-3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute the likelihood</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-8" class="code-annotation-target"><a href="#annotated-cell-3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(y)</span>
<span id="annotated-cell-3-9"><a href="#annotated-cell-3-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># compute the mean value for the data point</span></span>
<span id="annotated-cell-3-10"><a href="#annotated-cell-3-10" aria-hidden="true" tabindex="-1"></a>        μ <span class="op">=</span> a <span class="op">+</span> b <span class="op">*</span> x[i]</span>
<span id="annotated-cell-3-11"><a href="#annotated-cell-3-11" aria-hidden="true" tabindex="-1"></a>        y[i] <span class="op">~</span> <span class="fu">Normal</span>(μ, σ)</span>
<span id="annotated-cell-3-12"><a href="#annotated-cell-3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="annotated-cell-3-13"><a href="#annotated-cell-3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-3" data-code-annotation="1">Standard deviations must be positive, so we use a normal distribution truncated at zero.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="4,5" data-code-cell="annotated-cell-3" data-code-annotation="2">We’ll keep these both relative uninformative to reflect a more “realistic” modeling scenario.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="8" data-code-cell="annotated-cell-3" data-code-annotation="3">In this case, we specify the likelihood with a loop. We could also rewrite this as a joint likelihood over all of the data using linear algebra, which might be more efficient for large and/or complex models or datasets, but the loop is more readable in this simple case.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>linear_regression (generic function with 2 methods)</code></pre>
</div>
</div>
</section>
<section id="fitting-the-model" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="fitting-the-model">Fitting The Model</h4>
<div class="page-columns page-full"><p>Now we can call the sampler to draw from the posterior. We’ll use the <a href="https://en.wikipedia.org/wiki/Hamiltonian_Monte_Carlo#No_U-Turn_Sampler">No-U-Turn sampler</a> <span class="citation" data-cites="Hoffman2014-gv">(<a href="#ref-Hoffman2014-gv" role="doc-biblioref">Hoffman &amp; Gelman, 2014</a>)</span>, which is a Hamiltonian Monte Carlo algorithm (a different category of MCMC sampler than the Metropolis-Hastings algorithm discussed in class). We’ll also use 4 chains so we can test that the chains are well-mixed, and each chain will be run for 5,000 iterations<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;Hamiltonian Monte Carlo samplers often need to be run for fewer iterations than Metropolis-Hastings samplers, as the exploratory step uses information about the gradient of the statistical model, versus the random walk of Metropolis-Hastings. The disadvantage is that this gradient information must be available, which is not always the case for external simulation models. Simulation models coded in Julia can usually be automatically differentiated by Turing’s tools, however.</p></li></div></div>
<div class="no-row-height column-margin column-container"><div id="ref-Hoffman2014-gv" class="csl-entry" role="listitem">
Hoffman, M. D., &amp; Gelman, A. (2014). The <span>No-U-Turn</span> sampler: Adaptively setting path lengths in <span>H</span>amiltonian <span>M</span>onte <span>C</span>arlo. <em>J. Mach. Learn. Res.</em>, <em>15</em>(47), 1593–1623.
</div></div><div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the sampler</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-2" class="code-annotation-target"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">linear_regression</span>(x, y)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-3" class="code-annotation-target"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>n_chains <span class="op">=</span> <span class="fl">4</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-4" class="code-annotation-target"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>n_per_chain <span class="op">=</span> <span class="fl">5000</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="4">4</button><span id="annotated-cell-4-5" class="code-annotation-target"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(model, <span class="fu">NUTS</span>(), <span class="fu">MCMCThreads</span>(), n_per_chain, n_chains, drop_warmup<span class="op">=</span><span class="cn">true</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="5">5</button><span id="annotated-cell-4-6" class="code-annotation-target"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> chain</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-4" data-code-annotation="1">Initialize the model with the data.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-4" data-code-annotation="2">We use multiple chains to help diagnose convergence.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-4" data-code-annotation="3">This sets the number of iterations for each chain.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-4" data-code-annotation="4">Sample from the posterior using NUTS and drop the iterations used to warmup the sampler. The <code>MCMCThreads()</code> call tells the sampler to use available processor threads for the multiple chains, but it will just sample them in serial if only one thread exists.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="6" data-code-cell="annotated-cell-4" data-code-annotation="5">The <code>@show</code> macro makes the display of the output a bit cleaner.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/F9Hbk/src/sample.jl:296</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Found initial step size
└   ϵ = 0.00625
┌ Info: Found initial step size
└   ϵ = 0.025</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Found initial step size
└   ϵ = 0.2
┌ Info: Found initial step size
└   ϵ = 0.003125</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling (1 threads):  50%|██████████████▌              |  ETA: 0:00:00</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling (1 threads): 100%|█████████████████████████████| Time: 0:00:01</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>chain = MCMC chain (5000×15×4 Array{Float64, 3})</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (5000×15×4 Array{Float64, 3}):
Iterations        = 1001:1:6000
Number of chains  = 4
Samples per chain = 5000
Wall duration     = 17.6 seconds
Compute duration  = 14.44 seconds
parameters        = σ, a, b
internals         = lp, n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size
Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">   ess_bulk </span> <span class="ansi-bold">   ess_tail </span> <span class="ansi-bold">    rhat</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">    Float64 </span> <span class="ansi-bright-black-fg">    Float64 </span> <span class="ansi-bright-black-fg"> Float64</span> ⋯
           σ    5.3881    0.9886    0.0097   10835.5758   10595.6871    1.0003 ⋯
           a    7.3483    2.1028    0.0231    8360.9948    8903.0798    1.0002 ⋯
           b    1.7993    0.1865    0.0021    8290.7784    8803.3686    1.0003 ⋯
<span class="ansi-cyan-fg">                                                                1 column omitted</span>
Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">    2.5% </span> <span class="ansi-bold">   25.0% </span> <span class="ansi-bold">   50.0% </span> <span class="ansi-bold">   75.0% </span> <span class="ansi-bold">   97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span>
           σ    3.8905    4.6873    5.2471    5.9322    7.7226
           a    3.1190    5.9784    7.3761    8.7487   11.4444
           b    1.4350    1.6773    1.7968    1.9214    2.1732
</pre>
</div>
</div>
</div>
<div class="page-columns page-full"><p>How can we interpret the output? The first parts of the summary statistics are straightforward: we get the mean, standard deviation, and Monte Carlo standard error (<code>mcse</code>) of each parameter. We also get information about the effective sample size (ESS)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and <span class="math inline">\(\hat{R}\)</span>, which measures the ratio of within-chain variance and across-chain variance as a check for convergence<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;The ESS reflects the efficiency of the sampler: this is an estimate of the equivalent number of independent samples; the more correlated the samples, the lower the ESS.</p></li><li id="fn3"><p><sup>3</sup>&nbsp;The closer <span class="math inline">\(\hat{R}\)</span> is to 1, the better.</p></li></div></div>
<p>In this case, we can see that we were generally able to recover the “true” data-generating values of <span class="math inline">\(\sigma = 4\)</span> and <span class="math inline">\(b = 2\)</span>, but <span class="math inline">\(a\)</span> is slightly off (the mean is 3, rather than the data-generating value of 5). In fact, there is substantial uncertainty about <span class="math inline">\(a\)</span>, with a 95% credible interval of <span class="math inline">\((3.1, 11.4)\)</span> (compared to <span class="math inline">\((1.4, 2.2)\)</span> for <span class="math inline">\(b\)</span>). This isn’t surprising: given the variance of the noise <span class="math inline">\(\sigma^2\)</span>, there are many different intercepts which could fit within that spread.</p>
<p>Let’s now plot the chains for visual inspection.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div id="fig-chains-regression" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="turing-mcmc_files/figure-html/fig-chains-regression-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Output from the MCMC sampler. Each row corresponds to a different parameter: <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(a\)</span>, and <span class="math inline">\(b\)</span>. Each chain is shown in a different color. The left column shows the sampler traceplots, and the right column the resulting posterior distributions.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can see from <a href="#fig-chains-regression">Figure&nbsp;2</a> that our chains mixed well and seem to have converged to similar distributions! The traceplots have a “hairy caterpiller” appearance, suggesting relatively little autocorrelation. We can also see how much more uncertainty there is with the intercept <span class="math inline">\(a\)</span>, while the slope <span class="math inline">\(b\)</span> is much more constrained.</p>
<p>Another interesting comparison we can make is with the maximum-likelihood estimate (MLE), which we can obtain through optimization.</p>
<div class="cell page-columns page-full" data-execution_count="8">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><span id="annotated-cell-6-1"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>mle_model <span class="op">=</span> <span class="fu">linear_regression</span>(x, y)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-2" class="code-annotation-target"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a>mle <span class="op">=</span> <span class="fu">optimize</span>(mle_model, <span class="fu">MLE</span>())</span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mle)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-6" data-code-annotation="1">This is where we use the <code>Optim.jl</code> package in this tutorial.</span>
</dd>
</dl>
</div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>3-element Named Vector{Float64}
A  │ 
───┼────────
σ  │ 4.75545
a  │ 7.65636
b  │ 1.77736</code></pre>
</div></div></div>
<p>We could also get the maximum <em>a posteriori</em> (MAP) estimate, which includes the prior density, by replacing <code>MLE()</code> with <code>MAP()</code>.</p>
</section>
</section>
<section id="model-diagnostics-and-posterior-predictive-checks" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="model-diagnostics-and-posterior-predictive-checks">Model Diagnostics and Posterior Predictive Checks</h3>
<p>One advantage of the Bayesian modeling approach here is that we have access to a <em>generative model</em>, or a model which we can use to generate datasets. This means that we can now use Monte Carlo simulation, sampling from our posteriors, to look at how uncertainty in the parameter estimates propagates through the model. Let’s write a function which gets samples from the MCMC chains and generates datasets.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mc_predict_regression</span>(x, chain)</span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the posterior samples</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">Array</span>(<span class="fu">group</span>(chain, <span class="op">:</span>a))</span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">Array</span>(<span class="fu">group</span>(chain, <span class="op">:</span>b))</span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">Array</span>(<span class="fu">group</span>(chain, <span class="op">:</span>σ))</span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop and generate alternative realizations</span></span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> a<span class="op">'</span> <span class="op">.+</span> x <span class="op">*</span> b<span class="op">'</span></span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="fu">zeros</span>((<span class="fu">length</span>(x), <span class="fu">length</span>(a)))</span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(a)</span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11" aria-hidden="true" tabindex="-1"></a>        y[<span class="op">:</span>, i] <span class="op">=</span> <span class="fu">rand</span>.(<span class="fu">Normal</span>.(μ[<span class="op">:</span>, i], σ[i]))</span>
<span id="annotated-cell-7-12"><a href="#annotated-cell-7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="annotated-cell-7-13"><a href="#annotated-cell-7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="annotated-cell-7-14"><a href="#annotated-cell-7-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="3,4,5" data-code-cell="annotated-cell-7" data-code-annotation="1">The <code>Array(group())</code> syntax is more general than we need, but is useful if we have multiple variables which were sampled as a group, for example multiple regression coefficients. Otherwise, we can just use <em>e.g.</em> <code>Array(chain, :a)</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>mc_predict_regression (generic function with 1 method)</code></pre>
</div>
</div>
<p>Now we can generate a predictive interval and median and compare to the data.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>x_pred <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">20</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> <span class="fu">mc_predict_regression</span>(x_pred, chain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>21×20000 Matrix{Float64}:
 -0.440341  14.2143    3.73736    3.98402  …  13.9896   12.1475    5.46884
 -7.87522    4.36333  -7.19389    3.34537      9.48413  11.4606    3.81313
 17.3151     8.9222    0.292523  12.9925       7.6094   11.5593   10.3064
  2.28767    7.4078    9.09122    9.90026     21.4866   21.4643    4.38994
 23.1321     9.28746   9.56973   17.9069      14.6245    6.80164  23.3068
 10.0429    12.6741   23.6552    24.0107   …  17.07     12.9291   19.7511
 23.3753    33.5452   11.6653    14.3672      21.4006   24.598    25.4434
 11.6998     7.79426  16.9991    17.8128       8.01083  19.9234   17.2112
 16.3753    22.476    20.8614    20.1019      15.169    22.8508   21.7635
 17.1411    14.5313   32.2826    23.3866      27.5636   22.508    19.5266
 27.7594    28.5052   30.7478    35.5763   …  22.858    27.8321   17.396
 28.2636    24.2078   23.8358    27.5576      23.1143   30.4325   25.8818
 35.3991    39.3917   40.5648    30.0351      29.1015   31.9592   38.7204
 27.9246    34.618    30.7003    31.2341      20.0888   18.9489   24.3442
 44.3301    21.7205   26.0331    34.8189      34.9326   26.6271   37.492
 29.0048    45.0313   38.5674    34.2622   …  38.0261   42.037    26.6537
 38.1531    35.6617   28.2519    36.4022      42.352    38.8477   38.4148
 41.646     26.0779   38.9314    42.054       30.3764   37.7851   40.6086
 38.4945    51.9845   42.9168    42.3723      37.3804   47.7923   38.3248
 37.3901    44.5299   44.5209    46.5456      35.1081   43.7139   47.2316
 55.3581    41.1191   45.0658    35.4023   …  40.9341   35.7394   36.0986</code></pre>
</div>
</div>
<p>Notice the dimension of <code>y_pred</code>: we have 20,000 columns, because we have 4 chains with 5,000 samples each. If we had wanted to subsample (which might be necessary if we had hundreds of thousands or millions of samples), we could have done that within <code>mc_linear_regression</code> before simulation.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the boundaries for the 95% prediction interval and the median</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>y_ci_low <span class="op">=</span> <span class="fu">quantile</span>.(<span class="fu">eachrow</span>(y_pred), <span class="fl">0.025</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>y_ci_hi <span class="op">=</span> <span class="fu">quantile</span>.(<span class="fu">eachrow</span>(y_pred), <span class="fl">0.975</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>y_med <span class="op">=</span> <span class="fu">quantile</span>.(<span class="fu">eachrow</span>(y_pred), <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s plot the prediction interval and median, and compare to the original data.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot prediction interval</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1">1</button><span id="annotated-cell-10-2" class="code-annotation-target"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x_pred, y_ci_low, fillrange<span class="op">=</span>y_ci_hi, xlabel<span class="op">=</span>L<span class="st">"</span><span class="sc">$</span>x<span class="sc">$</span><span class="st">", </span>ylabel<span class="st">=L"</span><span class="op">$</span>y<span class="op">$</span><span class="st">", fillalpha=0.3, fillcolor=:blue, label="</span><span class="fl">95</span><span class="op">%</span> Prediction Interval<span class="st">", legend=:topleft, linealpha=0)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2">2</button><span id="annotated-cell-10-3" class="code-annotation-target"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x_pred, y_med, color<span class="op">=:</span>blue, label<span class="op">=</span><span class="st">"Prediction Median"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3">3</button><span id="annotated-cell-10-4" class="code-annotation-target"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(x, y, color<span class="op">=:</span>red, label<span class="op">=</span><span class="st">"Data"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-10" data-code-annotation="1">Plot the 95% posterior prediction interval as a shaded blue ribbon.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-10" data-code-annotation="2">Plot the posterior prediction median as a blue line.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-10" data-code-annotation="3">Plot the data as discrete red points.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div id="fig-prediction-regression" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="turing-mcmc_files/figure-html/fig-prediction-regression-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Posterior 95% predictive interval and median for the linear regression model. The data is plotted in red for comparison.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>From <a href="#fig-prediction-regression">Figure&nbsp;3</a>, it looks like our model might be slightly under-confident, as with 20 data points, we would expect 5% of them (or 1 data point) to be outside the 95% prediction interval. It’s hard to tell with only 20 data points, though! We could resolve this by tightening our priors, but this depends on how much information we used to specify them in the first place. The goal shouldn’t be to hit a specific level of uncertainty, but if there is a sound reason to tighten the priors, we could do so.</p>
<p>Now let’s look at the residuals from the posterior median and the data. The partial autocorrelations plotted in <a href="#fig-residuals-regression">Figure&nbsp;4</a> are not fully convincing, as there are large autocorrelation coefficients with long lags, but the dataset is quite small, so it’s hard to draw strong conclusions. We won’t go further down this rabbit hole as we know our data-generating process involved independent noise, but for a real dataset, we might want to try a model specification with autocorrelated errors to compare.</p>
<div class="cell page-columns page-full" data-execution_count="13">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode julia code-annotation-code code-with-copy"><code class="sourceCode julia"><span id="annotated-cell-11-1"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the median predictions and residuals</span></span>
<span id="annotated-cell-11-2"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a>y_pred_data <span class="op">=</span> <span class="fu">mc_predict_regression</span>(x, chain)</span>
<span id="annotated-cell-11-3"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a>y_med_data <span class="op">=</span> <span class="fu">quantile</span>.(<span class="fu">eachrow</span>(y_pred_data), <span class="fl">0.5</span>)</span>
<span id="annotated-cell-11-4"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> y_med_data <span class="op">.-</span> y</span>
<span id="annotated-cell-11-5"><a href="#annotated-cell-11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-6"><a href="#annotated-cell-11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the residuals and a line to show the zero</span></span>
<span id="annotated-cell-11-7"><a href="#annotated-cell-11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">pacf</span>(residuals, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>), line<span class="op">=:</span>stem, marker<span class="op">=:</span>circle, legend<span class="op">=:</span><span class="cn">false</span>, grid<span class="op">=:</span><span class="cn">false</span>, linewidth<span class="op">=</span><span class="fl">2</span>, xlabel<span class="op">=</span><span class="st">"Lag"</span>, ylabel<span class="op">=</span><span class="st">"Partial Autocorrelation"</span>, markersize<span class="op">=</span><span class="fl">8</span>, tickfontsize<span class="op">=</span><span class="fl">14</span>, guidefontsize<span class="op">=</span><span class="fl">16</span>, legendfontsize<span class="op">=</span><span class="fl">16</span>)</span>
<span id="annotated-cell-11-8"><a href="#annotated-cell-11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hline!</span>([<span class="fl">0</span>], linestyle<span class="op">=:</span>dot, color<span class="op">=:</span>red)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="14">
<div id="fig-residuals-regression" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="turing-mcmc_files/figure-html/fig-residuals-regression-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Partial autocorrelation function of model residuals, relative to the predictive median.</figcaption><p></p>
</figure>
</div>
</div></div></div>
</section>
</section>
<section id="fitting-extreme-value-models-to-tide-gauge-data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="fitting-extreme-value-models-to-tide-gauge-data">Fitting Extreme Value Models to Tide Gauge Data</h2>
<p>Let’s now look at an example of fitting an extreme value distribution (namely, a <a href="https://en.wikipedia.org/wiki/Generalized_extreme_value_distribution">generalized extreme value distribution</a>, or GEV) to tide gauge data. GEV distributions have three parameters:</p>
<ul>
<li><span class="math inline">\(\mu\)</span>, the <em>location</em> parameter, which reflects the positioning of the bulk of the GEV distribution;</li>
<li><span class="math inline">\(\sigma\)</span>, the <em>scale</em> parameter, which reflects the width of the bulk;</li>
<li><span class="math inline">\(\xi\)</span>, the <em>shape</em> parameter, which reflects the thickness and boundedness of the tail.</li>
</ul>
<p>The shape parameter <span class="math inline">\(\xi\)</span> is often of interest, as there are three classes of GEV distributions corresponding to different signs:</p>
<ul>
<li><span class="math inline">\(\xi &lt; 0\)</span> means that the distribution is bounded;</li>
<li><span class="math inline">\(\xi = 0\)</span> means that the distribution has a thinner tail, so the “extreme extremes” are less likely;</li>
<li><span class="math inline">\(\xi &gt; 0\)</span> means that the distribution has a thicker tail.</li>
</ul>
<section id="load-data" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="load-data">Load Data</h3>
<p>First, let’s load the data. We’ll use <a href="https://uhslc.soest.hawaii.edu/datainfo/">data from the University of Hawaii Sea Level Center</a> <span class="citation" data-cites="Caldwell2015-kc">(<a href="#ref-Caldwell2015-kc" role="doc-biblioref">Caldwell et al., 2015</a>)</span> for San Francisco, from 1897-2013. If you don’t have this data and are working with the notebook, download it <a href="https://uhslc.soest.hawaii.edu/data/csv/rqds/hourly/h551a.csv">here</a>. We’ll assume it’s in a <code>data/</code> subdirectory, but change the path as needed.</p>
<div class="no-row-height column-margin column-container"><div id="ref-Caldwell2015-kc" class="csl-entry" role="listitem">
Caldwell, P. C., Merrifield, M. A., &amp; Thompson, P. R. (2015). Sea level measured by tide gauges from global oceans — the joint archive for sea level holdings (<span>NCEI</span> accession 0019568). NOAA National Centers for Environmental Information (NCEI). <a href="https://doi.org/10.7289/V5V40S7W">https://doi.org/10.7289/V5V40S7W</a>
</div></div><p>The dataset consists of dates and hours and the tide-gauge measurement, in mm. We’ll load the dataset into a <code>DataFrame</code>.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><span id="annotated-cell-12-1"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_data</span>(fname)</span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a>    date_format <span class="op">=</span> <span class="fu">DateFormat</span>(<span class="st">"yyyy-mm-dd HH:MM:SS"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1">1</button><span id="annotated-cell-12-3" class="code-annotation-target"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> fname <span class="cf">begin</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2">2</button><span id="annotated-cell-12-4" class="code-annotation-target"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a>        CSV.<span class="fu">File</span>(; delim<span class="op">=</span><span class="ch">','</span>, header<span class="op">=</span><span class="cn">false</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3">3</button><span id="annotated-cell-12-5" class="code-annotation-target"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a>        DataFrame</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4">4</button><span id="annotated-cell-12-6" class="code-annotation-target"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="st">"Column1"</span> <span class="op">=&gt;</span> <span class="st">"year"</span>,</span>
<span id="annotated-cell-12-7"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Column2"</span> <span class="op">=&gt;</span> <span class="st">"month"</span>,</span>
<span id="annotated-cell-12-8"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Column3"</span> <span class="op">=&gt;</span> <span class="st">"day"</span>,</span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Column4"</span> <span class="op">=&gt;</span> <span class="st">"hour"</span>,</span>
<span id="annotated-cell-12-10"><a href="#annotated-cell-12-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Column5"</span> <span class="op">=&gt;</span> <span class="st">"gauge"</span>)</span>
<span id="annotated-cell-12-11"><a href="#annotated-cell-12-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># need to reformat the decimal date in the data file</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="5">5</button><span id="annotated-cell-12-12" class="code-annotation-target"><a href="#annotated-cell-12-12" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>datetime <span class="op">=</span> <span class="fu">DateTime</span>.(<span class="op">:</span>year, <span class="op">:</span>month, <span class="op">:</span>day, <span class="op">:</span>hour)</span>
<span id="annotated-cell-12-13"><a href="#annotated-cell-12-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># replace -99999 with missing</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="6">6</button><span id="annotated-cell-12-14" class="code-annotation-target"><a href="#annotated-cell-12-14" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>gauge <span class="op">=</span> <span class="fu">ifelse</span>.(<span class="fu">abs</span>.(<span class="op">:</span>gauge) <span class="op">.&gt;=</span> <span class="fl">9999</span>, <span class="cn">missing</span>, <span class="op">:</span>gauge)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="7">7</button><span id="annotated-cell-12-15" class="code-annotation-target"><a href="#annotated-cell-12-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="op">:</span>datetime, <span class="op">:</span>gauge)</span>
<span id="annotated-cell-12-16"><a href="#annotated-cell-12-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="annotated-cell-12-17"><a href="#annotated-cell-12-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="annotated-cell-12-18"><a href="#annotated-cell-12-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-12" data-code-annotation="1">This uses the <code>DataFramesMeta.jl</code> package, which makes it easy to string together commands to load and process data</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-12" data-code-annotation="2">Load the file, assuming there is no header.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-12" data-code-annotation="3">Convert to a <code>DataFrame</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="6,7,8,9,10" data-code-cell="annotated-cell-12" data-code-annotation="4">Rename columns for ease of access.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="12" data-code-cell="annotated-cell-12" data-code-annotation="5">Reformat the decimal datetime provided in the file into a Julia <code>DateTime</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="6">6</dt>
<dd>
<span data-code-lines="14" data-code-cell="annotated-cell-12" data-code-annotation="6">Replace missing data with <code>missing</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="7">7</dt>
<dd>
<span data-code-lines="15" data-code-cell="annotated-cell-12" data-code-annotation="7">Select only the <code>:datetime</code> and <code>:gauge</code> columns.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>load_data (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell page-columns page-full" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> <span class="fu">load_data</span>(<span class="st">"data/h551a.csv"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(dat, <span class="fl">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="16">
<div><div style="float: left;"><span>6×2 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<div id="tbl-data" class="anchored">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;1: Processed hourly tide gauge data from San Francisco, from 8/1/1897-1/31/2023.</caption>
<thead>
<tr class="header header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">datetime</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">gauge</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="DateTime">DateTime</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Int64}">Int64?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">1897-08-01T08:00:00</td>
<td style="text-align: right;">3292</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">1897-08-01T09:00:00</td>
<td style="text-align: right;">3322</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">1897-08-01T10:00:00</td>
<td style="text-align: right;">3139</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: left;">1897-08-01T11:00:00</td>
<td style="text-align: right;">2835</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: left;">1897-08-01T12:00:00</td>
<td style="text-align: right;">2377</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">6</td>
<td style="text-align: left;">1897-08-01T13:00:00</td>
<td style="text-align: right;">2012</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div></div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><button class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1">1</button><span id="annotated-cell-14-1" class="code-annotation-target"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> dat <span class="fu">plot</span>(<span class="op">:</span>datetime, <span class="op">:</span>gauge, label<span class="op">=</span><span class="st">"Observations"</span>, bottom_margin<span class="op">=</span><span class="fl">9</span>mm)</span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xaxis!</span>(<span class="st">"Date"</span>, xrot<span class="op">=</span><span class="fl">30</span>)</span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">yaxis!</span>(<span class="st">"Mean Water Level"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-14" data-code-annotation="1">This uses the <code>DataFrame</code> plotting recipe with the <code>@df</code> macro from <code>StatsPlots.jl</code>. This is not needed (you could replace <em>e.g.</em> <code>:datetime</code> with <code>dat.datetime</code>), but it cleans things up slightly.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div id="fig-raw-data" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="turing-mcmc_files/figure-html/fig-raw-data-output-1.png" class="img-fluid figure-img" alt="Tide gauge data"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Hourly mean water at the San Francisco tide gauge from 1897-2023.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Next, we need to detrend the data to remove the impacts of sea-level rise. We do this by removing a one-year moving average, centered on the data point, per the recommendation of <span class="citation" data-cites="Arns2013-tl">Arns et al. (<a href="#ref-Arns2013-tl" role="doc-biblioref">2013</a>)</span>.</p>
<div class="no-row-height column-margin column-container"></div><div class="cell page-columns page-full" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the moving average and subtract it off</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ma_length <span class="op">=</span> <span class="fl">366</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ma_offset <span class="op">=</span> <span class="fu">Int</span>(<span class="fu">floor</span>(ma_length<span class="op">/</span><span class="fl">2</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">moving_average</span>(series,n) <span class="op">=</span> [<span class="fu">mean</span>(<span class="pp">@view</span> series[i<span class="op">-</span>n<span class="op">:</span>i<span class="op">+</span>n]) for i <span class="kw">in</span> n<span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(series)<span class="op">-</span>n]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>dat_ma <span class="op">=</span> <span class="fu">DataFrame</span>(datetime<span class="op">=</span>dat.datetime[ma_offset<span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="kw">end</span><span class="op">-</span>ma_offset], residual<span class="op">=</span>dat.gauge[ma_offset<span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="kw">end</span><span class="op">-</span>ma_offset] <span class="op">.-</span> <span class="fu">moving_average</span>(dat.gauge, ma_offset))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> dat_ma <span class="fu">plot</span>(<span class="op">:</span>datetime, <span class="op">:</span>residual, label<span class="op">=</span><span class="st">"Detrended Observations"</span>, bottom_margin<span class="op">=</span><span class="fl">9</span>mm)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">xaxis!</span>(<span class="st">"Date"</span>, xrot<span class="op">=</span><span class="fl">30</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">yaxis!</span>(<span class="st">"Mean Water Level"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display page-columns page-full" data-execution_count="18">
<div id="fig-data-detrend" class="quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="turing-mcmc_files/figure-html/fig-data-detrend-output-1.png" class="img-fluid figure-img" alt="Detrended tide gauge data"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: Mean water level from the San Francisco tide gauge, detrended using a 1-year moving average centered on the data point, per the recommendation of <span class="citation" data-cites="Arns2013-tl">Arns et al. (<a href="#ref-Arns2013-tl" role="doc-biblioref">2013</a>)</span>.</figcaption><div class="no-row-height column-margin column-container"><div id="ref-Arns2013-tl" class="csl-entry" role="listitem">
Arns, A., Wahl, T., Haigh, I. D., Jensen, J., &amp; Pattiaratchi, C. (2013). Estimating extreme water level probabilities: A comparison of the direct methods and recommendations for best practise. <em>Coast. Eng.</em>, <em>81</em>, 51–66. <a href="https://doi.org/10.1016/j.coastaleng.2013.07.003">https://doi.org/10.1016/j.coastaleng.2013.07.003</a>
</div></div><p></p>
</figure>
</div>
</div>
</div>
<p>The last step in preparing the data is to find the annual maxima. We can do this using the <code>groupby</code>, <code>transform</code>, and <code>combine</code> functions from <code>DataFrames.jl</code>, as below.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="annotated-cell-16"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><span id="annotated-cell-16-1"><a href="#annotated-cell-16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the annual maxima</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1">1</button><span id="annotated-cell-16-2" class="code-annotation-target"><a href="#annotated-cell-16-2" aria-hidden="true" tabindex="-1"></a>dat_ma <span class="op">=</span> <span class="fu">dropmissing</span>(dat_ma)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="2">2</button><span id="annotated-cell-16-3" class="code-annotation-target"><a href="#annotated-cell-16-3" aria-hidden="true" tabindex="-1"></a>dat_annmax <span class="op">=</span> <span class="fu">combine</span>(dat_ma <span class="op">-&gt;</span> dat_ma[<span class="fu">argmax</span>(dat_ma.residual), <span class="op">:</span>],</span>
<span id="annotated-cell-16-4"><a href="#annotated-cell-16-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">groupby</span>(<span class="fu">transform</span>(dat_ma, <span class="op">:</span>datetime <span class="op">=&gt;</span> <span class="fu">x-&gt;year</span>.(x)), <span class="op">:</span>datetime_function))</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="3">3</button><span id="annotated-cell-16-5" class="code-annotation-target"><a href="#annotated-cell-16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">delete!</span>(dat_annmax, <span class="fu">nrow</span>(dat_annmax))</span>
<span id="annotated-cell-16-6"><a href="#annotated-cell-16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-16-7"><a href="#annotated-cell-16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make a histogram of the maxima to see the distribution</span></span>
<span id="annotated-cell-16-8"><a href="#annotated-cell-16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(dat_annmax.residual, label<span class="op">=</span><span class="cn">false</span>)</span>
<span id="annotated-cell-16-9"><a href="#annotated-cell-16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ylabel!</span>(<span class="st">"Count"</span>)</span>
<span id="annotated-cell-16-10"><a href="#annotated-cell-16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">xlabel!</span>(<span class="st">"Mean Water Level (mm)"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-16" data-code-annotation="1">If we don’t drop the values which are missing, they will affect the next call to <code>argmax</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="3,4" data-code-cell="annotated-cell-16" data-code-annotation="2">This first groups the data based on the year (with <code>groupby</code> and using <code>Dates.year()</code> to get the year of each data point), then pulls the rows which correspond to the maxima for each year (using <code>argmax</code>).</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-16" data-code-annotation="3">This will delete the last year, in this case 2023, because the dataset only goes until March 2023 and this data point is almost certainly an outlier due to the limited data from that year.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div id="fig-annmax-histogram" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="turing-mcmc_files/figure-html/fig-annmax-histogram-output-1.png" class="img-fluid figure-img" alt="Annual maxima histogram"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Histogram of annual block maxima from 1898-2022 from the San Francisco tide gauge dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-the-model">Fit The Model</h3>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode julia code-annotation-code code-with-copy code-annotated"><code class="sourceCode julia"><span id="annotated-cell-17-1"><a href="#annotated-cell-17-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">gev_annmax</span>(y)               </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1">1</button><span id="annotated-cell-17-2" class="code-annotation-target"><a href="#annotated-cell-17-2" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">1000</span>, <span class="fl">100</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2">2</button><span id="annotated-cell-17-3" class="code-annotation-target"><a href="#annotated-cell-17-3" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">100</span>); lower<span class="op">=</span><span class="fl">0</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="3">3</button><span id="annotated-cell-17-4" class="code-annotation-target"><a href="#annotated-cell-17-4" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">0.5</span>)</span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="4">4</button><span id="annotated-cell-17-6" class="code-annotation-target"><a href="#annotated-cell-17-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">~</span> <span class="fu">GeneralizedExtremeValue</span>(μ, σ, ξ)</span>
<span id="annotated-cell-17-7"><a href="#annotated-cell-17-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="annotated-cell-17-8"><a href="#annotated-cell-17-8" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="5">5</button><span id="annotated-cell-17-9" class="code-annotation-target"><a href="#annotated-cell-17-9" aria-hidden="true" tabindex="-1"></a>gev_model <span class="op">=</span> <span class="fu">gev_annmax</span>(dat_annmax.residual)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="6">6</button><span id="annotated-cell-17-10" class="code-annotation-target"><a href="#annotated-cell-17-10" aria-hidden="true" tabindex="-1"></a>n_chains <span class="op">=</span> <span class="fl">4</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="7">7</button><span id="annotated-cell-17-11" class="code-annotation-target"><a href="#annotated-cell-17-11" aria-hidden="true" tabindex="-1"></a>n_per_chain <span class="op">=</span> <span class="fl">5000</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="8">8</button><span id="annotated-cell-17-12" class="code-annotation-target"><a href="#annotated-cell-17-12" aria-hidden="true" tabindex="-1"></a>gev_chain <span class="op">=</span> <span class="fu">sample</span>(gev_model, <span class="fu">NUTS</span>(), <span class="fu">MCMCThreads</span>(), n_per_chain, n_chains; drop_warmup<span class="op">=</span><span class="cn">true</span>)</span>
<span id="annotated-cell-17-13"><a href="#annotated-cell-17-13" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> gev_chain</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-17" data-code-annotation="1">Location parameter prior: We know that this is roughly on the 1000 mm order of magnitude, but want to keep this relatively broad.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-17" data-code-annotation="2">Scale parameter prior: This parameter must be positive, so we use a normal truncated at zero.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-17" data-code-annotation="3">Shape parameter prior: These are usually small and are hard to constrain, so we will use a more informative prior.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="6" data-code-cell="annotated-cell-17" data-code-annotation="4">The data is independently GEV-distributed as we’ve removed the long-term trend and are using long blocks.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="9" data-code-cell="annotated-cell-17" data-code-annotation="5">Initialize the model.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="6">6</dt>
<dd>
<span data-code-lines="10" data-code-cell="annotated-cell-17" data-code-annotation="6">We use multiple chains to help diagnose convergence.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="7">7</dt>
<dd>
<span data-code-lines="11" data-code-cell="annotated-cell-17" data-code-annotation="7">This sets the number of iterations for each chain.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="8">8</dt>
<dd>
<span data-code-lines="12" data-code-cell="annotated-cell-17" data-code-annotation="8">Sample from the posterior using NUTS and drop the iterations used to warmup the sampler.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Warning: Only a single thread available: MCMC chains are not sampled in parallel
└ @ AbstractMCMC ~/.julia/packages/AbstractMCMC/F9Hbk/src/sample.jl:296</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Found initial step size
└   ϵ = 0.2
┌ Info: Found initial step size
└   ϵ = 0.0125</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>┌ Info: Found initial step size
└   ϵ = 0.2
┌ Info: Found initial step size
└   ϵ = 0.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling (1 threads):  50%|██████████████▌              |  ETA: 0:00:03</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling (1 threads): 100%|█████████████████████████████| Time: 0:00:06</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>gev_chain = MCMC chain (5000×15×4 Array{Float64, 3})</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (5000×15×4 Array{Float64, 3}):
Iterations        = 1001:1:6000
Number of chains  = 4
Samples per chain = 5000
Wall duration     = 13.26 seconds
Compute duration  = 12.89 seconds
parameters        = μ, σ, ξ
internals         = lp, n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size
Summary Statistics
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">      mean </span> <span class="ansi-bold">     std </span> <span class="ansi-bold">    mcse </span> <span class="ansi-bold">   ess_bulk </span> <span class="ansi-bold">   ess_tail </span> <span class="ansi-bold">    rh</span> ⋯
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg"> Float64 </span> <span class="ansi-bright-black-fg">    Float64 </span> <span class="ansi-bright-black-fg">    Float64 </span> <span class="ansi-bright-black-fg"> Float</span> ⋯
           μ   1257.8174    5.6701    0.0513   12216.6653   12642.3312    1.00 ⋯
           σ     57.1982    4.3214    0.0366   14201.5441   12575.6044    1.00 ⋯
           ξ      0.0292    0.0625    0.0008    5915.1552    7463.8803    1.00 ⋯
<span class="ansi-cyan-fg">                                                               2 columns omitted</span>
Quantiles
 <span class="ansi-bold"> parameters </span> <span class="ansi-bold">      2.5% </span> <span class="ansi-bold">     25.0% </span> <span class="ansi-bold">     50.0% </span> <span class="ansi-bold">     75.0% </span> <span class="ansi-bold">     97.5% </span>
 <span class="ansi-bright-black-fg">     Symbol </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span> <span class="ansi-bright-black-fg">   Float64 </span>
           μ   1246.8628   1253.9821   1257.8132   1261.6027   1269.2078
           σ     49.4284     54.1859     56.9353     59.9665     66.3174
           ξ     -0.0811     -0.0151      0.0250      0.0699      0.1627
</pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gev_chain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div id="fig-gev-traceplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="turing-mcmc_files/figure-html/fig-gev-traceplot-output-1.png" class="img-fluid figure-img" alt="MCMC sampler output"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;8: Traceplots (left) and marginal distributions (right) from the MCMC sampler for the GEV model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>From <a href="#fig-gev-traceplot">Figure&nbsp;8</a>, it looks like all of the chains have converged to the same distribution; the Gelman-Rubin diagnostic is also close to 1 for all parameters. Next, we can look at a corner plot to see how the parameters are correlated.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corner</span>(gev_chain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div id="fig-gev-corner" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="turing-mcmc_files/figure-html/fig-gev-corner-output-1.png" class="img-fluid figure-img" alt="GEV corner plot"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9: Corner plot for the GEV model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-gev-corner">Figure&nbsp;9</a> suggests that the location and scale parameters <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> are positively correlated. This makes some intuitive sense, as increasing the location parameter shifts the bulk of the distribution in a positive direction, and the increasing scale parameter then increases the likelihood of lower values. However, if these parameters are increased, the shape parameter <span class="math inline">\(\xi\)</span> decreases, as the tail of the GEV does not need to be as thick due to the increased proximity of outliers to the bulk.</p>



</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../tutorials/julia-plots.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Making Plots</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© 2023, Vivek Srikrishnan</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This page was built with <a href="https://quarto.org">Quarto</a>.</div>
  </div>
</footer>



</body></html>